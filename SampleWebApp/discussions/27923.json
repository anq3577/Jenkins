[
  {
    "Id": "93190",
    "ThreadId": "27923",
    "Html": "<p>I'm running Club Starter Kit &quot;v2 RC1&quot; and my SMTP server must have just enacted a limit of how may email addresses can be in the &quot;To:&quot; line before it thinks the email is spam.  Below is the VB code that the site uses to send emails.  Does anyone know the fastest way to revise this code to make it work.  Maybe send the email in groups of 10 recipients or send them one at a time for everyone in the group selected.  Any tips are greatly appreciated.  I just need to be able to get emails out!<br>\r\n<br>\r\n<span style=\"font-size:13px\">\r\n<p> </p>\r\n<p>   <br>\r\nProtected Sub btnSend_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles btnSend.Click<br>\r\n        'Ensure that at least one role has been selected.<br>\r\n        Dim recipientChecked As Boolean = False<br>\r\n        For Each item As ListItem In chkRecipients.Items<br>\r\n            If item.Selected Then<br>\r\n                recipientChecked = True<br>\r\n                Exit For<br>\r\n            End If<br>\r\n        Next</p>\r\n<p>        If recipientChecked = False Then<br>\r\n            If chkAllMembers.Checked = False Then<br>\r\n                'No recipients were selected.  We can exit the sub.<br>\r\n                lblError.Text = &quot;No recipients selected.&quot;<br>\r\n                lblError.Visible = True<br>\r\n                Return<br>\r\n            End If<br>\r\n        Else<br>\r\n            lblError.Text = &quot;&quot;<br>\r\n            lblError.Visible = False<br>\r\n        End If</p>\r\n<p>        'Check to see if someone missed clicking Upload.  If this is the case, AttachmentFile upload control will have a file.<br>\r\n        If String.IsNullOrEmpty(AttachmentFile.FileName) OrElse AttachmentFile.PostedFile Is Nothing Then<br>\r\n        Else<br>\r\n            fileUpload_Click(Me, System.EventArgs.Empty)<br>\r\n        End If</p>\r\n<p>        Dim haveAttachment As Boolean = False<br>\r\n        Dim strFiles() As String = Nothing</p>\r\n<p>        If txtAttachments.Text.Length &gt; 0 Then<br>\r\n            strFiles = Split(txtAttachments.Text, ControlChars.NewLine)<br>\r\n            haveAttachment = True<br>\r\n        End If</p>\r\n<p>        Dim ToAddresses As MailAddressCollection = GetRecipients()</p>\r\n<p>        Dim mem As MembershipUser = Membership.GetUser()<br>\r\n        Dim gui As New Guid(mem.ProviderUserKey.ToString)<br>\r\n        Dim name As String = GetName(gui)<br>\r\n        Dim msgFrom As New MailAddress(mem.Email.ToString(), name.ToString())<br>\r\n        Dim msgMail As New MailMessage(msgFrom, msgFrom)</p>\r\n<p>        For Each msgTo As MailAddress In ToAddresses<br>\r\n            msgMail.Bcc.Add(msgTo)<br>\r\n        Next</p>\r\n<p>        msgMail.Subject = txtSubject.Text</p>\r\n<p>        msgMail.IsBodyHtml = True<br>\r\n        msgMail.Body = FCKeditor1.Value</p>\r\n<p>        If haveAttachment Then<br>\r\n            Dim str As String<br>\r\n            For Each str In strFiles<br>\r\n                If str = &quot;&quot; Then Continue For<br>\r\n                msgMail.Attachments.Add(New Attachment(strPath &amp; str))<br>\r\n            Next<br>\r\n        End If<br>\r\n        Dim smtp As New SmtpClient(ConfigurationManager.AppSettings(&quot;ClubMailServer&quot;).ToString())<br>\r\n        Dim a As New Net.NetworkCredential(ConfigurationManager.AppSettings(&quot;ClubMailUsername&quot;).ToString(), ConfigurationManager.AppSettings(&quot;ClubMailPassword&quot;).ToString())<br>\r\n        smtp.UseDefaultCredentials = False<br>\r\n        smtp.Credentials = a<br>\r\n        smtp.Send(msgMail)<br>\r\n        Response.Redirect(&quot;~/default.aspx&quot;)</p>\r\n<p>    End Sub</p>\r\n</span></p>\r\n<p>&nbsp;</p>\r\n<p> </p>\r\n<p><span style=\"font-size:13px;color:#0000ff\">\r\n<p> </p>\r\n</span></p>\r\n<p>&nbsp;</p>\r\n<p> </p>\r\n",
    "PostedDate": "2008-05-17T14:06:57.84-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "93282",
    "ThreadId": "27923",
    "Html": "<p>I figured it out.  It is as simple as moving the &quot;Next&quot; statement down and adding a clear statement before  <strong>msgMail.Bcc.Add(msgTo)</strong><br>\r\n<br>\r\n        For Each msgTo As MailAddress In ToAddresses<br>\r\n            <strong>msgMail.To.Clear()</strong> <em><strong>'clears the &quot;To:&quot; variable for the next email address.  VERY IMPORTANT!</strong> </em><br>\r\n            msgMail.To.Add(msgTo)<br>\r\n           <em> <strong>''Next  'Comment out old next function...</strong><br>\r\n</em>            'The next was moved down so emails would send through mail.kendaleoaks.com one at a time.</p>\r\n<p>            msgMail.Subject = txtSubject.Text</p>\r\n<p>            msgMail.IsBodyHtml = True<br>\r\n            msgMail.Body = FCKeditor1.Value</p>\r\n<p>            If haveAttachment Then<br>\r\n                Dim str As String<br>\r\n                For Each str In strFiles<br>\r\n                    If str = &quot;&quot; Then Continue For<br>\r\n                    msgMail.Attachments.Add(New Attachment(strPath &amp; str))<br>\r\n                Next<br>\r\n            End If<br>\r\n            Dim smtp As New SmtpClient(ConfigurationManager.AppSettings(&quot;ClubMailServer&quot;).ToString())<br>\r\n            Dim a As New Net.NetworkCredential(ConfigurationManager.AppSettings(&quot;ClubMailUsername&quot;).ToString(), ConfigurationManager.AppSettings(&quot;ClubMailPassword&quot;).ToString())<br>\r\n            smtp.UseDefaultCredentials = False<br>\r\n            smtp.Credentials = a<br>\r\n            smtp.Send(msgMail)<br>\r\n        <strong>Next</strong> <strong>'new next statement locaion so the code sends one email at a time to members.</strong><br>\r\n        Response.Redirect(&quot;~/default.aspx&quot;)</p>\r\n",
    "PostedDate": "2008-05-18T16:04:28.433-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]