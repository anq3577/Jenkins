[
  {
    "Id": "70661",
    "ThreadId": "21234",
    "Html": "\r\nFor some reason my club web site throws the following error when a reply is posted to a thread.  I am using ver 3 beta 1.  Other sites using this seem to work ok.  I have not carried out any mods to the code.  The error being thrown is:<br />The INSERT statement conflicted with the FOREIGN KEY constraint \"FK<i>MembersThreads</i>Threads\". The conflict occurred in database \"westmidlandsvsoc\", table \"dbo.Threads\", column 'threadid'.<br />The statement has been terminated. <br />Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. <br /><br />Exception Details: System.Data.SqlClient.SqlException: The INSERT statement conflicted with the FOREIGN KEY constraint \"FK<i>MembersThreads</i>Threads\". The conflict occurred in database \"westmidlandsvsoc\", table \"dbo.Threads\", column 'threadid'.<br />The statement has been terminated.<br /><br />Source Error: <br /><br /><br />Line 108:<br />Line 109:        Public Shared Sub MarkThreadRead(ByVal threadid As Integer, ByVal memberid As Guid)<br />Line 110:            SPs.MarkThreadRead(threadid, memberid).Execute()<br />Line 111:        End Sub<br />Line 112:<br /><br /><br />Source File: C:\\Users\\Chris\\Desktop\\Documents\\Visual Studio 2005\\Projects\\Club Site 7088 2008\\ClubStarterKit.Web\\App_Code\\BLL\\Forum.vb    Line: 110 <br /><br />Stack Trace: <br /><br /><br />[SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_MembersThreads_Threads\". The conflict occurred in database \"westmidlandsvsoc\", table \"dbo.Threads\", column 'threadid'.<br />The statement has been terminated.]<br />   System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection) +859322<br />   System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection) +736198<br />   System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj) +188<br />   System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj) +1959<br />   System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString) +149<br />   System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async) +903<br />   System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result) +132<br />   System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(DbAsyncResult result, String methodName, Boolean sendToPipe) +415<br />   System.Data.SqlClient.SqlCommand.ExecuteNonQuery() +135<br />   SubSonic.SqlDataProvider.ExecuteQuery(QueryCommand qry) in C:\\SubSonic 2.0.3\\src\\SubSonic\\DataProviders\\SqlDataProvider.cs:196<br />   SubSonic.StoredProcedure.Execute() in C:\\SubSonic 2.0.3\\src\\SubSonic\\ActiveRecord\\StoredProcedure.cs:152<br />   ClubStarterKit.Web.Forum.MarkThreadRead(Int32 threadid, Guid memberid) in C:\\Users\\Chris\\Desktop\\Documents\\Visual Studio 2005\\Projects\\Club Site 7088 2008\\ClubStarterKit.Web\\App_Code\\BLL\\Forum.vb:110<br />   ASP.forum<i>addpost</i>aspx.UpdateButton_Click(Object sender, EventArgs e) in C:\\Users\\Chris\\Desktop\\Documents\\Visual Studio 2005\\Projects\\Club Site 7088 2008\\ClubStarterKit.Web\\Forum\\AddPost.aspx:102<br />   System.Web.UI.WebControls.LinkButton.OnClick(EventArgs e) +105<br />   System.Web.UI.WebControls.LinkButton.RaisePostBackEvent(String eventArgument) +107<br />   System.Web.UI.WebControls.LinkButton.System.Web.UI.IPostBackEventHandler.RaisePostBackEvent(String eventArgument) +7<br />   System.Web.UI.Page.RaisePostBackEvent(IPostBackEventHandler sourceControl, String eventArgument) +11<br />   System.Web.UI.Page.RaisePostBackEvent(NameValueCollection postData) +174<br />   System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +5102<br /><br /><b>Does anyone have any suggestions?</b><br />",
    "PostedDate": "2008-01-29T11:45:25.207-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "71335",
    "ThreadId": "21234",
    "Html": "\r\nI have investigated further and have tracked it down to the following code in 'Forum/AddPost.aspx'<br /><br />    Protected Sub UpdateButton_Click(ByVal sender As Object, ByVal e As System.EventArgs)<br />        Dim uGuid As Guid = New Guid(Membership.GetUser.ProviderUserKey.ToString())<br /><br />&gt;...............................................................................................ooOOOoo......................................................        <br /><br /><b>ClubStarterKit.Web.Forum.MarkThreadRead(newmsgthreadid, uGuid)</b><br />        ClubStarterKit.Web.Forum.SetThreadWatch(newmsgthreadid, uGuid, CheckBoxWatch.Checked)<br /><br />        Response.Redirect(\"thread.aspx?th=\" &amp; newmsgthreadid.ToString, True)<br />    End Sub<br /><br />The parameter uGuid in the call to 'MarkThreadRead' highlighted in bold is 'Empty' at this point.<br /><br />I have tried replacing the first line of the function: <br />        Dim uGuid As Guid = New Guid(Membership.GetUser.ProviderUserKey.ToString())<br /><br />with this:<br />        Dim guidString As String = Membership.GetUser.ProviderUserKey.ToString()<br />        Dim uGuid As Guid = New Guid(guidString)<br /><br /> but uGuid still returns 'Empty'<br /><br /><b>Does anyone have any suggestions on how this can be fixed?</b><br />",
    "PostedDate": "2008-02-02T02:22:02.647-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "71500",
    "ThreadId": "21234",
    "Html": "\r\nIt's not clear if your problem is related to mine, which is that the forum works ok, but the blog doesn't allow carriage returns.  When pressing \"enter\", the cursor stays on the same line, so there's no way to create paragraphs.  Is it designed that way?  It's the latest release running on Windows Server 2008, and this is something I've not noticed in other programs.  Thanks for any possible help on this.<br />",
    "PostedDate": "2008-02-03T18:44:51.247-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "74646",
    "ThreadId": "21234",
    "Html": "\r\nWhen you do a quick watch on a guid it will always say empty, add the .tostring after the guid in quickwatch and it will display the GUID.<br /><br />I have nailed this issue down to a problem with the BLL forum.vb line 101.<br /><br />If you call sp.exectue its returning the number of lines that have been effected. Not the thread number.<br /><br />I resolved this by chaniging the SP AddMessage to Select the @threadID then rather than calling execute I called exectue scalar.<br /><br />-- Ammended BLL<br /><br />Dim sp As StoredProcedure = SPs.AddMessage(msg.parentmsgid, msg.memberid, msg.body, msg.subject, AdminOnly, msg.topicid)<br />Dim threadid As Integer = sp.ExecuteScalar()<br /><br />---Ammended SP Code<br /><br />ALTER PROCEDURE <a href=\"http://www.codeplex.com/ClubStarterKit/Wiki/View.aspx?title=dbo\">dbo</a>.<a href=\"http://www.codeplex.com/ClubStarterKit/Wiki/View.aspx?title=AddMessage\">AddMessage</a><br />\t@parentmsgid int,<br />\t@memberid uniqueidentifier,<br />\t@body ntext,<br />\t@subject nvarchar(255),<br />\t@admin bit,<br />\t@topicid int<br />AS<br />declare @threadid int<br /><br />IF @parentmsgid = 0<br />\tBEGIN<br />\t\tINSERT INTO Threads (lastpostdate, lastpostby, topicid, admin) values(GetDate(), @memberid, @topicid, @admin)<br />\t\tSELECT        @threadid = IDENT_CURRENT('Threads')<br />\tEND<br />else<br />\tBEGIN<br />\t\tSELECT @threadid = threadid FROM Messages WHERE id = @parentmsgid<br />\t\tUPDATE Threads SET lastpostdate = GetDate(), lastpostby = @memberid WHERE threadid = @threadid<br />\tEND<br /><br />INSERT INTO Messages<br />                         (memberid, subject, body, threadid, parentmsgid, answer)<br />VALUES        (@memberid,@subject,@body,@threadid,@parentmsgid, 0)<br /><br />\tselect @threadid<br /><br /><br /><br /><br /><br /><br /><br />",
    "PostedDate": "2008-02-18T06:33:59.173-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "83609",
    "ThreadId": "21234",
    "Html": "\r\nHi,<br /><br />I too would appreciate some help with this issue. I've tried to follow the fix above and now as admin I can create, delete and edit forum posts with no errors, but if I try and view a post when not logged in I get :-<br /><br />Object reference not set to an instance of an object. <br />Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. <br /><br />Exception Details: System.NullReferenceException: Object reference not set to an instance of an object.<br /><br />Source Error: <br /><br />Line 266:    <br />Line 267:    Private Function IsSelf(ByVal messageid As Integer) As Boolean<br />Line 268:        Dim CurrentGUID As Guid = Membership.GetUser().ProviderUserKey()<br />Line 269:        Dim OrigionalMessageGUID As Guid = ClubStarterKit.Web.Forum.GetMemGuidByMsg(messageid)<br />Line 270:        <br /><br />Source File: G:\\My Documents\\Visual Studio 2005\\WebSites\\Clubs2\\Forum\\Thread.aspx    Line: 268 <br /><br />Stack Trace: <br /><br /><a href=\"http://www.codeplex.com/ClubStarterKit/Wiki/View.aspx?title=NullReferenceException%3a%20Object%20reference%20not%20set%20to%20an%20instance%20of%20an%20object.\">NullReferenceException: Object reference not set to an instance of an object.</a><br />   ASP.forum<i>thread</i>aspx.IsSelf(Int32 messageid) in G:\\My Documents\\Visual Studio 2005\\WebSites\\Clubs2\\Forum\\Thread.aspx:268<br />   ASP.forum<i>thread</i>aspx.CanEdit(Int32 messageid) in G:\\My Documents\\Visual Studio 2005\\WebSites\\Clubs2\\Forum\\Thread.aspx:144<br />   ASP.forum<i>thread</i>aspx.<i>_DataBinding_</i>control18(Object sender, EventArgs e) in G:\\My Documents\\Visual Studio 2005\\WebSites\\Clubs2\\Forum\\Thread.aspx:356<br />   System.Web.UI.Control.OnDataBinding(EventArgs e) +99<br />   System.Web.UI.Control.DataBind(Boolean raiseOnDataBinding) +206<br />   System.Web.UI.Control.DataBind() +12<br />   System.Web.UI.Control.DataBindChildren() +204<br />   System.Web.UI.Control.DataBind(Boolean raiseOnDataBinding) +216<br />   System.Web.UI.Control.DataBind() +12<br />   System.Web.UI.WebControls.Repeater.CreateItem(Int32 itemIndex, ListItemType itemType, Boolean dataBind, Object dataItem) +130<br />   System.Web.UI.WebControls.Repeater.CreateControlHierarchy(Boolean useDataSource) +454<br />   System.Web.UI.WebControls.Repeater.OnDataBinding(EventArgs e) +53<br />   System.Web.UI.WebControls.Repeater.DataBind() +72<br />   System.Web.UI.WebControls.Repeater.EnsureDataBound() +55<br />   System.Web.UI.WebControls.Repeater.OnPreRender(EventArgs e) +12<br />   System.Web.UI.Control.PreRenderRecursiveInternal() +86<br />   System.Web.UI.Control.PreRenderRecursiveInternal() +170<br />   System.Web.UI.Control.PreRenderRecursiveInternal() +170<br />   System.Web.UI.Control.PreRenderRecursiveInternal() +170<br />   System.Web.UI.Control.PreRenderRecursiveInternal() +170<br />   System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +2041<br /><br />I guess because the GUID is zero? I'm rather new to asp so would appreciate any help on how to fix this error.<br /><br />Cheers.<br />",
    "PostedDate": "2008-03-28T14:30:21.207-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "86792",
    "ThreadId": "21234",
    "Html": "\r\n\"Dim sp As StoredProcedure = SPs.AddMessage(msg.parentmsgid, msg.memberid, msg.body, msg.subject, AdminOnly, msg.topicid)<br />Dim threadid As Integer = sp.ExecuteScalar()\"...martinbeeby<br /><br />Where do I put this code?  Inside \"MarkThreadRead\"?<br />",
    "PostedDate": "2008-04-14T18:59:44.48-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]